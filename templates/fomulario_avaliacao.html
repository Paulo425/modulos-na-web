{% extends 'base.html' %}

{% block conteudo %}

    <meta charset="utf-8">
    <title>Formul√°rio de Avalia√ß√£o PHOENIX APPRAISAL</title>
    <style>
        body {
            margin: 40px;
            background: #000033; 
            font-family: Arial, sans-serif;
            text-align: center;
            transition: all 0.3s ease;
        }
        h1 {
            margin-bottom: 20px;
            text-align: center;
            color: #ffffff;
        }
        form {
            display: block;
            width: 80%;
            max-width: 640px;
            margin: 0 auto; 
            background: #ffffff; 
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0px 0px 20px rgba(0,0,0,0.3);
            text-align: left;
            color: #000;
        }
        .dark-mode form {
            background: #2f2f2f !important;
            color: #ffffff !important;
        }
        .dark-mode form label {
            color: #ffffff !important;
        }
        .dark-mode .input-change::placeholder {
            color: #000000 !important;
        }
        .toggle-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 14px 24px;
            border-radius: 8px;
            font-weight: bold;
            border: none;
            cursor: pointer;
            color: #ffffff;
            background-color: #1e90ff;
            font-size: 16px;
            box-shadow: 0px 0px 8px rgba(0,0,0,0.3);
        }
        .toggle-btn:hover {
            filter: brightness(1.1);
        }
        label {
            display: block;
            font-weight: bold;
            margin-top: 15px;
            margin-bottom: 5px;
        }
        .input-change {
            width: 100%;
            box-sizing: border-box;
            padding: 10px;
            margin: auto;
            font-size: 14px;
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 3px;
            box-shadow: inset 2px 2px 4px rgba(0,0,0,0.1);
        }
        input[type="file"].file-green {
            width: 100%;
        }
        input[type="file"].file-green::-webkit-file-upload-button {
            background-color: #006400;
            color: #ffffff;
            padding: 10px 20px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
        }
        input[type="file"].file-green::file-selector-button {
            background-color: #006400;
            color: #ffffff;
            padding: 10px 20px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
        }
        .btn {
            margin-top: 20px;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: #fff;
            background-color: #006400; 
        }
        .btn:hover {
            filter: brightness(1.2);
        }
        .center-btn {
            text-align: center;
        }
        .restricoes-container {
            border: 1px solid #ccc;
            padding: 15px;
            margin-top: 15px;
            border-radius: 5px;
            background: #f0f0f0;
            box-shadow: inset 2px 2px 4px rgba(0,0,0,0.1);
        }
        hr {
            margin: 20px 0;
        }
        .subtitle {
            margin-top: 30px;
            font-weight: bold;
            font-size: 1.1em;
        }
        .notice {
            font-size: 0.9em;
            color: #555;
        }
        .small-explanation {
            font-size: 13px;
            line-height: 1.3em;
            text-align: justify;
            text-justify: inter-word;
            margin-bottom: 5px;
            width: 100%;
        }

        /* For√ßar cor verde se autofill em inputs do Chrome */
        input:-webkit-autofill {
            background-color: #ccffcc !important;
            transition: background-color 5000s ease-in-out 0s;
        }
        input:-webkit-autofill:focus {
            background-color: #ccffcc !important;
        }
    </style>

    <button class="toggle-btn" onclick="toggleDarkMode()">
        Alternar Modo
    </button>

    <h1>FORMUL√ÅRIO DE AVALIA√á√ÉO PHOENIX APPRAISAL</h1>

    <form method="post" enctype="multipart/form-data">

        <label>INSIRA AQUI SUA PLANILHA DE AMOSTRAS (Excel):</label>
        <input type="file" name="planilha_excel" class="input-change file-green" required>

        <label>Informe o nome completo do propriet√°rio do im√≥vel:</label>
        <input type="text" name="nome_proprietario" class="input-change" placeholder="Ex: Jos√© da Silva" required>

        <label>Existem outros propriet√°rios? (Sim ou N√£o):</label>
        <select name="outros_proprietarios" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>

        <label>Deseja incluir telefone do propriet√°rio? (Sim ou N√£o):</label>
        <select name="incluir_tel" id="incluirTelSelect" class="input-change" onchange="toggleTelefoneCampo()">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
        <div id="telefoneCampo" style="display:none;">
          <label>Digite o telefone do propriet√°rio:</label>
          <input type="text" name="telefone_proprietario" class="input-change" placeholder="Ex: (47) 99999-8888">
        </div>

        <label>Deseja incluir email do propriet√°rio? (Sim ou N√£o):</label>
        <select name="incluir_mail" id="incluirMailSelect" class="input-change" onchange="toggleEmailCampo()">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
        <div id="emailCampo" style="display:none;">
          <label>Digite o email do propriet√°rio:</label>
          <input type="text" name="email_proprietario" class="input-change" placeholder="Ex: exemplo@dominio.com">
        </div>

        <label>Informe o nome do solicitante do laudo:</label>
        <input type="text" name="nome_solicitante" class="input-change" placeholder="Ex: Prefeitura Municipal de Joinville-SC">

        <label>Informe o nome do avaliador respons√°vel:</label>
        <input type="text" name="nome_avaliador" class="input-change" placeholder="Ex: Eng. Civil Paulo Roberto">

        <label>Informe o registro profissional do avaliador:</label>
        <input type="text" name="registro_avaliador" class="input-change" placeholder="Ex: CREA SP 45.678/D">

        <label>Qual tipo de im√≥vel est√° sendo avaliado?</label>
        <select name="tipo_imovel_escolhido" class="input-change">
            <option value="" disabled selected>Selecione</option>
            <option value="Apartamento residencial">Apartamento residencial</option>
            <option value="Casa residencial">Casa residencial</option>
            <option value="Terreno urbano">Terreno urbano</option>
            <option value="Gleba urbana">Gleba urbana</option>
            <option value="Terreno rural">Terreno rural</option>
            <option value="Gleba rural">Gleba rural</option>
        </select>

        <label>Qual a finalidade do laudo?</label>
        <select name="finalidade_lido" id="finalidadeSelect" class="input-change"
                onchange="atualizarAreaLabel(); exibirRestricoesSeNecessario(); exibirCampoOutraFinalidade();">
            <option value="" disabled selected>Selecione</option>
            <option value="Desapropria√ß√£o">Desapropria√ß√£o</option>
            <option value="Garantia banc√°ria">Garantia banc√°ria</option>
            <option value="Invent√°rio e partilha">Invent√°rio e partilha</option>
            <option value="Obten√ß√£o do pre√ßo de mercado">Obten√ß√£o do pre√ßo de mercado</option>
            <option value="Loca√ß√£o">Loca√ß√£o</option>
            <option value="Regulariza√ß√£o fiscal">Regulariza√ß√£o fiscal</option>
            <option value="Seguros patrimoniais">Seguros patrimoniais</option>
            <option value="Servid√£o administrativa">Servid√£o administrativa</option>
            <option value="Outra">Outra</option>
        </select>
        <div id="outraFinalidadeCampo" style="display:none;">
          <label>Descreva a finalidade:</label>
          <input type="text" name="finalidade_descricao" class="input-change" placeholder="Ex: Avalia√ß√£o judicial espec√≠fica">
        </div>


        <label id="areaLabel">Insira a √°rea total do im√≥vel a ser avaliado (m¬≤)</label>
        <div id="areaInfoBox" style="display:none; margin:5px 0 15px 0; padding:10px; border:1px solid #b20000; border-radius:5px; background-color:#ffe6e6; color:#b20000; font-size:13px;">
          <strong>IMPORTANTE:</strong> Para desapropria√ß√£o/servid√£o, a √°rea que voc√™ digitar aqui ser√° utilizada para todos os c√°lculos, independente da √°rea na planilha.
        </div>
        
        <input type="text" name="area_parcial" class="input-change" placeholder="Ex: 29.567,89">

        <!-- RESTRI√á√ïES -->
        <div id="restricoesSectionContainer" style="display:none;">
          <hr>
          <div class="subtitle">M√∫ltiplas Restri√ß√µes</div>
          <p class="notice">Insira todas as restri√ß√µes desejadas. Ao clicar em "Adicionar Restri√ß√£o", outra aparecer√°.</p>
          <div id="restricoesSection"></div>
          <button type="button" class="btn" onclick="addRestricao()">Adicionar Restri√ß√£o</button>
          <hr>
        </div>

        <div class="subtitle">FATORES DE HOMOGENEIZA√á√ÉO DAS AMOSTRAS</div>

        <label>Fator √Årea</label>
        <p class="small-explanation">
          Tem como objetivo adequar o valor da amostra √† √°rea do avaliando, aplicando ((√Årea da amostra /
          √Årea do avaliando)^(0,25)), atenuando grandes distor√ß√µes (Abunahman, Ed. Pini).
        </p>
        <label>Usar fator √Årea? (Sim ou N√£o)</label>
        <select name="usar_fator_area" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
        <hr>

        <label>Fator Oferta</label>
        <p class="small-explanation">
          Ajusta os valores para 0,90 se h√° indica√ß√£o clara de oferta abundante. Caso contr√°rio, 1,00. Este
          fator previne distor√ß√µes em cen√°rios com alto estoque de im√≥veis.
        </p>
        <label>Usar fator Oferta? (Sim ou N√£o)</label>
        <select name="usar_fator_oferta" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
        <hr>

        <label>Fator Aproveitamento</label>
        <p class="small-explanation">
          Se urbano, adota-se 1,00; se rural, 0,80. Metodologia adaptada de Jo√£o Ruy Canteiro (Ed. Pini),
          considerando o potencial construtivo do im√≥vel.
        </p>
        <label>Usar fator Aproveitamento? (Sim ou N√£o)</label>
        <select name="usar_fator_aproveitamento" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
        <hr>

        <label>Fator Localiza√ß√£o</label>
        <p class="small-explanation">
          Se amostras e avaliando est√£o na mesma regi√£o (~1 km), fator=1,00; caso contr√°rio, utiliza-se
          f√≥rmula adaptada de Martins & Martins (2014, p.341) baseada na dist√¢ncia.
        </p>
        <label>O im√≥vel avaliando est√° na mesma regi√£o (~1km) das amostras? (Sim ou N√£o)</label>
        <select name="localizacao_mesma_regiao" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
        <hr>

        <label>Fator Topografia</label>
        <p class="small-explanation">
          Se a topografia for boa, emprega-se 1,10; caso contr√°rio, 1,00. Adapta√ß√£o de Jo√£o R. Canteiro
          (Ed. Pini), refletindo o relevo do terreno.
        </p>
        <label>Usar fator Topografia? (Sim ou N√£o)</label>
        <select name="usar_fator_topografia" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
        <hr>

        <label>Fator Pedologia</label>
        <p class="small-explanation">
          Caso o solo seja alag√°vel, aplica-se 0,70 (deprecia√ß√£o de 30%). Se normal, 1,00. Crit√©rio baseado
          em Jo√£o R. Canteiro (Ed. Pini).
        </p>
        <label>Usar fator Pedologia? (Sim ou N√£o)</label>
        <select name="usar_fator_pedologia" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
        <hr>

        <label>Fator Pavimenta√ß√£o</label>
        <p class="small-explanation">
          Presen√ßa de pavimenta√ß√£o mant√©m fator 1,00; aus√™ncia reduz para 0,90. Segue o crit√©rio de
          Mendes Sobrinho, indicando 10% de desvaloriza√ß√£o.
        </p>
        <label>Usar fator Pavimenta√ß√£o? (Sim ou N√£o)</label>
        <select name="usar_fator_pavimentacao" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
        <hr>

        <label>Fator Esquina</label>
        <p class="small-explanation">
          Terrenos em esquina recebem fator 1,10; os demais, 1,00. Conforme Thofehrn (2008), h√° um
          acr√©scimo limitado a 10% para compensar recuos.
        </p>
        <label>Usar fator Esquina? (Sim ou N√£o)</label>
        <select name="usar_fator_esquina" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
        <hr>

        <label>Fator Acessibilidade</label>
        <p class="small-explanation">
          Boa acessibilidade, fator 1,00; em caso de acesso dif√≠cil, 0,90. Adaptado do crit√©rio de Mendes
          Sobrinho, demonstrando 10% de deprecia√ß√£o.
        </p>
        <label>Usar fator Acessibilidade? (Sim ou N√£o)</label>
        <select name="usar_fator_acessibilidade" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
        <hr>

        <label>N√∫mero da matr√≠cula (documenta√ß√£o do im√≥vel):</label>
        <input type="text" name="num_doc" class="input-change" placeholder="Ex: 12.345">

        <label>Nome do cart√≥rio:</label>
        <input type="text" name="nome_cartorio" class="input-change" placeholder="Ex: Of√≠cio de Registros P√∫blicos">

        <label>Nome da comarca:</label>
        <input type="text" name="nome_comarca" class="input-change" placeholder="Ex: Joinville-SC">

        <label>Endere√ßo completo do im√≥vel:</label>
        <input type="text" name="endereco_imovel" class="input-change"
               placeholder="Ex: Rua Dr. Pl√°cido Olimpio de Oliveira, 1277 - Anita Garibaldi - Joinville-SC">

        <hr>
        <div class="subtitle">Diagn√≥stico de Mercado</div>

        <label>Estrutura</label>
        <p class="small-explanation">
          Pode ser BOA (facilidade de encontrar im√≥veis similares na regi√£o) ou LIMITADA (dificuldade).
        </p>
        <select name="estrutura_escolha" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="BOA">BOA</option>
          <option value="LIMITADA">LIMITADA</option>
        </select>
        <hr>

        <label>Conduta</label>
        <p class="small-explanation">
          DESESTAGNADO (boa movimenta√ß√£o do mercado) ou ESTAGNADA (pouca movimenta√ß√£o).
        </p>
        <select name="conduta_escolha" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="DESESTAGNADO">DESESTAGNADO</option>
          <option value="ESTAGNADA">ESTAGNADA</option>
        </select>
        <hr>

        <label>Desempenho</label>
        <p class="small-explanation">
          ALTO (grande atratividade comercial), M√âDIO (atratividade moderada) ou BAIXO (baixa atratividade).
        </p>
        <select name="desempenho_escolha" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="ALTO">ALTO</option>
          <option value="M√âDIO">M√âDIO</option>
          <option value="BAIXO">BAIXO</option>
        </select>

        <hr>
        <div class="subtitle">Selecione as fotos do im√≥vel (m√∫ltiplas):</div>
        <input type="file" name="fotos_imovel" class="input-change file-green" multiple>



        <label>Selecione arquivo de imagem do logo (se desejar):</label>
        <input type="file" name="arquivo_logo" class="input-change file-green">

        <br><br>
        <div class="center-btn">
          <button type="submit" class="btn">Gerar Laudo</button>
        </div>
	
        {% if resultado %}
        <div class="alert alert-success mt-4 text-center">
            {{ resultado }}
        </div>
        {% endif %}

        {% if zip_download %}
        <div class="alert alert-success mt-4 text-center">
            üì¶ <strong>Download dispon√≠vel:</strong><br>
            <a class="btn btn-success mt-2" href="{{ url_for('static', filename='arquivos/' ~ zip_download) }}" download>
                Baixar Relat√≥rio ZIP
            </a>
        </div>
        {% endif %}

        {% if erro %}
        <div class="alert alert-danger mt-4 text-center">
            {{ erro }}
        </div>
        {% endif %}

    </form>

    <script>
      function toggleDarkMode() {
          document.body.classList.toggle("dark-mode");
      }

    function atualizarAreaLabel() {
        const finalidadeSelect = document.getElementById("finalidadeSelect");
        const valor = (finalidadeSelect.value || "").trim().toLowerCase();
        const areaLabel = document.getElementById("areaLabel");
        const areaInput = document.querySelector('input[name="area_parcial"]');
    
        if (valor.includes("desapropria")) {
            areaLabel.innerHTML = "<strong>√ÅREA A SER DESAPROPRIADA (m¬≤)</strong> - Esta √© a √°rea que ser√° utilizada para c√°lculo final indenizat√≥rio";
            areaLabel.style.color = "#b20000"; // vermelho escuro
            if (areaInput) areaInput.style.borderColor = "#b20000";
        } else if (valor.includes("servid")) {
            areaLabel.innerHTML = "<strong>√ÅREA TOTAL DE INTERESSE (m¬≤)</strong> - Esta √© a √°rea que ser√° utilizada para c√°lculo final indenizat√≥rio";
            areaLabel.style.color = "#b20000"; // vermelho escuro  
            if (areaInput) areaInput.style.borderColor = "#b20000";
        } else {
            areaLabel.innerHTML = "Insira a √°rea total do im√≥vel a ser avaliado (m¬≤)";
            areaLabel.style.color = ""; // cor padr√£o
            if (areaInput) areaInput.style.borderColor = "";
        }
    }

    
    // Modificar a fun√ß√£o exibirRestricoesSeNecessario para tamb√©m ajustar o comportamento da √°rea
    function exibirRestricoesSeNecessario() {
        const select = document.getElementById("finalidadeSelect");
        const valor = (select.value || "").trim().toLowerCase();
        const restricoesContainer = document.getElementById("restricoesSectionContainer");
        const areaInput = document.getElementById("area_parcial"); // Assumindo que o campo de √°rea tem este id
        
        // Definir cor de fundo laranja para o container de restri√ß√µes
        restricoesContainer.style.backgroundColor = "#ffe8cc"; // Fundo laranja claro
        restricoesContainer.style.padding = "15px";
        restricoesContainer.style.borderRadius = "8px";
        restricoesContainer.style.marginTop = "20px";
        restricoesContainer.style.marginBottom = "20px";
        restricoesContainer.style.border = "2px solid #ff8c00"; // Borda laranja
        
        // Mostrar imediatamente se for desapropria√ß√£o ou servid√£o
        
        if (valor.includes("desapropria") || valor.includes("servid") || valor.includes("regulariza")) {       
        
            // Mostrar o container de restri√ß√µes
            restricoesContainer.style.display = "block";
            
            // Marcar o campo de √°rea como sendo a √°rea de interesse (n√£o a da planilha)
            if (areaInput) {
                areaInput.setAttribute("data-use-for-calculation", "true");
            }
            
            // Aplicar destaque aos campos
            const camposRestricoes = restricoesContainer.querySelectorAll('.input-change');
            camposRestricoes.forEach(campo => {
                // Verificar estado inicial
                if (campo.value.trim() !== '') {
                    campo.style.backgroundColor = '#ccffcc'; // Verde se j√° tiver valor
                }
                
                // Adicionar listeners para mudan√ßas
                campo.addEventListener('input', () => {
                    if (campo.value.trim() !== '') {
                        campo.style.backgroundColor = '#ccffcc'; // Verde quando preenchido
                    } else {
                        campo.style.backgroundColor = '#f0f0f0'; // Cor padr√£o quando vazio
                    }
                });
            });
            
            // Observar novos campos adicionados
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.addedNodes.length) {
                        const novosCampos = restricoesContainer.querySelectorAll('.input-change:not([data-observed])');
                        novosCampos.forEach(campo => {
                            campo.setAttribute('data-observed', 'true');
                            if (campo.value.trim() !== '') {
                                campo.style.backgroundColor = '#ccffcc';
                            }
                            campo.addEventListener('input', () => {
                                if (campo.value.trim() !== '') {
                                    campo.style.backgroundColor = '#ccffcc';
                                } else {
                                    campo.style.backgroundColor = '#f0f0f0';
                                }
                            });
                        });
                    }
                });
            });
            
            observer.observe(restricoesContainer, { childList: true, subtree: true });
        } else {
            restricoesContainer.style.display = "none";
            
            // Remover o atributo para casos que n√£o s√£o desapropria√ß√£o ou servid√£o
            if (areaInput) {
                areaInput.removeAttribute("data-use-for-calculation");
            }
        }
    }
    
    // Executar a fun√ß√£o quando a p√°gina carrega
    document.addEventListener('DOMContentLoaded', exibirRestricoesSeNecessario);




// Adicionar esta linha para executar a fun√ß√£o quando a p√°gina carrega
document.addEventListener('DOMContentLoaded', exibirRestricoesSeNecessario);

      function toggleTelefoneCampo() {
          const telSelect = document.getElementById("incluirTelSelect");
          const telCampo = document.getElementById("telefoneCampo");
          if (telSelect.value === "sim") {
              telCampo.style.display = "block";
          } else {
              telCampo.style.display = "none";
          }
      }

      function toggleEmailCampo() {
          const mailSelect = document.getElementById("incluirMailSelect");
          const mailCampo = document.getElementById("emailCampo");
          if (mailSelect.value === "sim") {
              mailCampo.style.display = "block";
          } else {
              mailCampo.style.display = "none";
          }
      }

      function exibirCampoOutraFinalidade() {
          const finalidade = document.getElementById("finalidadeSelect").value;
          const outraCampo = document.getElementById("outraFinalidadeCampo");
          if (finalidade === "Outra") {
              outraCampo.style.display = "block";
          } else {
              outraCampo.style.display = "none";
          }
      }

      let restricaoCount = 0;
      function addRestricao() {
        restricaoCount++;
        const container = document.getElementById('restricoesSection');
        const divR = document.createElement('div');
        divR.className = "restricoes-container";
        divR.innerHTML = `
          <label>Tipo de restri√ß√£o (ex: APP, Servid√£o, Outro) [${restricaoCount}]:</label>
          <input type="text" name="tipo_restricao_${restricaoCount}" class="input-change" placeholder="Ex: APP ou Servid√£o">

          <label>√Årea (m¬≤) com essa restri√ß√£o [${restricaoCount}]:</label>
          <input type="text" name="area_restricao_${restricaoCount}" class="input-change" placeholder="Ex: 500.0">

          <label>Porcentagem de deprecia√ß√£o (ex: 66) [${restricaoCount}]:</label>
          <input type="text" name="depreciacao_restricao_${restricaoCount}" class="input-change" placeholder="Ex: 66">
        `;
        container.appendChild(divR);
      }

      // Faz todos os campos input-change (incluindo select) ficarem verdes se preenchidos
      
      
    document.addEventListener('DOMContentLoaded', function() {
        // ... outros c√≥digos existentes ...
        
        // Executar fun√ß√µes importantes na carga da p√°gina
        atualizarAreaLabel();
        exibirRestricoesSeNecessario();
    });      
      
      
          atualizarAreaLabel();
          exibirRestricoesSeNecessario();
          exibirCampoOutraFinalidade();

          const allFields = document.querySelectorAll('.input-change');

          function checkFill(elem) {
              // Se for SELECT e o value != "", fica verde
              if (elem.tagName === 'SELECT') {
                  if (elem.value.trim() !== '') {
                      elem.style.backgroundColor = '#ccffcc';
                  } else {
                      elem.style.backgroundColor = '#f0f0f0';
                  }
              } else {
                  // Para inputs text/file
                  if (elem.value.trim() !== '') {
                      elem.style.backgroundColor = '#ccffcc';
                  } else {
                      elem.style.backgroundColor = '#f0f0f0';
                  }
              }
          }

          // Verifica periodicamente (para capturar autofill)
          setInterval(() => {
              allFields.forEach(f => checkFill(f));
          }, 1000);

          allFields.forEach(field => {
              // Se j√° vier preenchido
              checkFill(field);

              // Monitorar eventos
              field.addEventListener('input',   () => checkFill(field));
              field.addEventListener('change',  () => checkFill(field));
              field.addEventListener('focusout',() => checkFill(field));
          });

      });
    </script>


    <script>

    function atualizarAreaLabel() {
        const finalidadeSelect = document.getElementById('finalidadeSelect');
        const valor = (finalidadeSelect.value || "").trim().toLowerCase();
        const areaLabel = document.getElementById('areaLabel');
        const areaInput = document.querySelector('input[name="area_parcial"]');
        const infoBox = document.getElementById('areaInfoBox');
        
        // Resetar estilos primeiro
        areaLabel.style.fontWeight = "normal";
        areaLabel.style.color = "";
        if (areaInput) {
            areaInput.style.borderColor = "";
            areaInput.style.backgroundColor = "#f0f0f0";
            areaInput.placeholder = "Ser√° validada com a planilha";
        }
        
        // Definir comportamento com base na finalidade
        if (valor.includes("desapropria")) {
            // Destacar visualmente
            areaLabel.innerHTML = "<strong>√ÅREA A SER DESAPROPRIADA (m¬≤)</strong>";
            areaLabel.style.color = "#b20000"; // vermelho escuro
            if (areaInput) {
                areaInput.style.borderColor = "#b20000";
                areaInput.style.borderWidth = "2px";
                areaInput.style.fontWeight = "bold";
                areaInput.placeholder = "Ex: 1.250,00";
            }
            
            // Mostrar caixa de informa√ß√£o
            if (infoBox) {
                infoBox.style.display = "block";
                infoBox.innerHTML = "<strong>IMPORTANTE:</strong> A √°rea que voc√™ digitar aqui substituir√° a √°rea total da planilha para todos os c√°lculos de valor e restri√ß√µes.";
            }
            
        } else if (valor.includes("servid")) {
            // Destacar visualmente
            areaLabel.innerHTML = "<strong>√ÅREA DE INTERESSE PARA SERVID√ÉO (m¬≤)</strong>";
            areaLabel.style.color = "#b20000"; // vermelho escuro
            if (areaInput) {
                areaInput.style.borderColor = "#b20000";
                areaInput.style.borderWidth = "2px";
                areaInput.style.fontWeight = "bold";
                areaInput.placeholder = "Ex: 3.500,00";
            }
            
            // Mostrar caixa de informa√ß√£o
            if (infoBox) {
                infoBox.style.display = "block";
                infoBox.innerHTML = "<strong>IMPORTANTE:</strong> A √°rea que voc√™ digitar aqui substituir√° a √°rea total da planilha para todos os c√°lculos de valor e restri√ß√µes.";
            }
            
        } else {
            // Finalidades comuns - usar √°rea da planilha
            areaLabel.innerHTML = "√Årea total do im√≥vel a ser avaliado (m¬≤)";
            
            // Esconder caixa de informa√ß√£o
            if (infoBox) {
                infoBox.style.display = "none";
            }
        }
    }
    
    // Executar na carga da p√°gina e quando o select for alterado
    window.addEventListener('DOMContentLoaded', function() {
        // Adicionar a caixa de informa√ß√£o se n√£o existir
        if (!document.getElementById('areaInfoBox')) {
            const infoBox = document.createElement('div');
            infoBox.id = 'areaInfoBox';
            infoBox.style.display = 'none';
            infoBox.style.margin = '5px 0 15px 0';
            infoBox.style.padding = '10px';
            infoBox.style.border = '1px solid #b20000';
            infoBox.style.borderRadius = '5px';
            infoBox.style.backgroundColor = '#ffe6e6';
            infoBox.style.color = '#b20000';
            infoBox.style.fontSize = '13px';
            
            // Inserir ap√≥s o label da √°rea
            const areaLabel = document.getElementById('areaLabel');
            if (areaLabel && areaLabel.parentNode) {
                areaLabel.parentNode.insertBefore(infoBox, areaLabel.nextSibling);
            }
        }
        
        // Executar inicialmente
        atualizarAreaLabel();
        
        // Garantir que o evento de mudan√ßa no select funcione
        const finalidadeSelect = document.getElementById('finalidadeSelect');
        if (finalidadeSelect) {
            finalidadeSelect.addEventListener('change', atualizarAreaLabel);
        }
    });

{% endblock %}