{% extends 'base.html' %}

{% block conteudo %}
<div class="container mt-5">
    <h2 class="text-primary mb-4 text-center">Formulário de Avaliação PHOENIX APPRAISAL</h2>

    <form method="post" enctype="multipart/form-data">
        <div class="mb-3">
            <label class="form-label">Planilha de Amostras (Excel):</label>
            <input type="file" name="planilha_excel" class="form-control input-change file-green" required>
        </div>

        <div class="mb-3">
            <label>Nome do Proprietário:</label>
            <input type="text" name="nome_proprietario" class="form-control input-change" required>
        </div>

        <div class="mb-3">
            <label>Outros Proprietários?</label>
            <select name="outros_proprietarios" class="form-select input-change">
                <option value="" disabled selected>Selecione</option>
                <option value="sim">Sim</option>
                <option value="nao">Não</option>
            </select>
        </div>

        <div class="mb-3">
            <label>Incluir telefone?</label>
            <select name="incluir_tel" id="incluirTelSelect" class="form-select input-change" onchange="toggleTelefoneCampo()">
                <option value="" disabled selected>Selecione</option>
                <option value="sim">Sim</option>
                <option value="nao">Não</option>
            </select>
            <div id="telefoneCampo" style="display:none;">
                <input type="text" name="telefone_proprietario" class="form-control input-change mt-2" placeholder="(00) 00000-0000">
            </div>
        </div>

        <div class="mb-3">
            <label>Incluir e-mail?</label>
            <select name="incluir_mail" id="incluirMailSelect" class="form-select input-change" onchange="toggleEmailCampo()">
                <option value="" disabled selected>Selecione</option>
                <option value="sim">Sim</option>
                <option value="nao">Não</option>
            </select>
            <div id="emailCampo" style="display:none;">
                <input type="email" name="email_proprietario" class="form-control input-change mt-2" placeholder="email@exemplo.com">
            </div>
        </div>

        <div class="mb-3">
            <label>Solicitante do laudo:</label>
            <input type="text" name="nome_solicitante" class="form-control input-change">
        </div>

        <div class="mb-3">
            <label>Nome do Avaliador:</label>
            <input type="text" name="nome_avaliador" class="form-control input-change">
        </div>

        <div class="mb-3">
            <label>Registro do Avaliador:</label>
            <input type="text" name="registro_avaliador" class="form-control input-change">
        </div>

        <div class="mb-3">
            <label>Tipo de Imóvel:</label>
            <select name="tipo_imovel_escolhido" class="form-select input-change">
                <option value="" disabled selected>Selecione</option>
                <option>Apartamento residencial</option>
                <option>Casa residencial</option>
                <option>Terreno urbano</option>
                <option>Gleba urbana</option>
                <option>Terreno rural</option>
                <option>Gleba rural</option>
            </select>
        </div>

        <div class="mb-3">
            <label>Finalidade do Laudo:</label>
            <select name="finalidade_lido" id="finalidadeSelect" class="form-select input-change" onchange="document.getElementById('outraFinalidade').style.display = this.value === 'Outra' ? 'block' : 'none'; atualizarAreaLabel(); exibirRestricoesSeNecessario();">
                <option value="" disabled selected>Selecione</option>
                <option>Desapropriação</option>
                <option>Servidão administrativa</option>
                <option>Garantia bancária</option>
                <option>Mercado</option>
                <option>Regularização</option>
                <option>Outra</option>
            </select>
            <input id="outraFinalidade" type="text" name="finalidade_descricao" class="form-control input-change mt-2" placeholder="Descreva a finalidade" style="display:none;">
        </div>

        <div class="mb-3">
            <label id="areaLabel">Insira a área total do imóvel a ser avaliado (m²)</label>
            <input type="text" name="area_parcial" class="form-control input-change" placeholder="Ex: 2.500,00">
        </div>

        <!-- Campos adicionais omitidos por brevidade -->

        <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary btn-lg">Gerar Laudo</button>
        </div>
    </form>
</div>

<script>
function toggleTelefoneCampo() {
    const telSelect = document.getElementById("incluirTelSelect");
    const telCampo = document.getElementById("telefoneCampo");
    telCampo.style.display = telSelect.value === "sim" ? "block" : "none";
}

function toggleEmailCampo() {
    const mailSelect = document.getElementById("incluirMailSelect");
    const mailCampo = document.getElementById("emailCampo");
    mailCampo.style.display = mailSelect.value === "sim" ? "block" : "none";
}

function atualizarAreaLabel() {
    const finalidadeSelect = document.getElementById("finalidadeSelect");
    const valor = (finalidadeSelect.value || "").trim().toLowerCase();
    const areaLabel = document.getElementById("areaLabel");
    if (valor.includes("desapropria")) {
        areaLabel.innerHTML = "<strong>ÁREA A SER DESAPROPRIADA (m²)</strong>";
        areaLabel.style.color = "#b20000";
    } else if (valor.includes("servid")) {
        areaLabel.innerHTML = "<strong>ÁREA TOTAL DE INTERESSE (m²)</strong>";
        areaLabel.style.color = "#b20000";
    } else {
        areaLabel.innerHTML = "Insira a área total do imóvel a ser avaliado (m²)";
        areaLabel.style.color = "";
    }
}

function exibirRestricoesSeNecessario() {
    const select = document.getElementById("finalidadeSelect");
    const valor = (select.value || "").trim().toLowerCase();
    const restricoesContainer = document.getElementById("restricoesSectionContainer");
    restricoesContainer.style.display = (valor.includes("desapropria") || valor.includes("servid") || valor.includes("regulariza")) ? "block" : "none";
}

setInterval(() => {
    document.querySelectorAll('.input-change').forEach(el => {
        el.style.backgroundColor = el.value.trim() !== '' ? '#ccffcc' : '#f0f0f0';
    });
}, 1000);
</script>

{% endblock %}
