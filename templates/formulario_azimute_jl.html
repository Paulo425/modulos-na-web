{% extends 'base.html' %}

{% block conteudo %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0 text-primary">MÃ³dulo: MEMORIAL_AZIMUTE_JL</h2>

  
</div>

<style>
  #spinner {
    display: none;
    text-align: center;
    margin-top: 20px;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelector('form').addEventListener('submit', function () {
      document.getElementById('spinner').style.display = 'block';
    });
  });
</script>

<form method="POST" enctype="multipart/form-data">
  <div id="spinner">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Processando...</span>
    </div>
    <p>Aguarde, processando o memorial...</p>
  </div>
  <div class="form-check form-switch mb-4">
                <input class="form-check-input" type="checkbox" id="sentidoPoligonal" name="sentidoPoligonal" value="anti_horario">
                <label class="form-check-label text-primary" for="sentidoPoligonal">
                    ðŸ”„ Sentido da Poligonal: <strong id="labelSentido">HorÃ¡rio (direita)</strong>
                </label>
            </div>

            <script>
            document.getElementById('sentidoPoligonal').addEventListener('change', function() {
                document.getElementById('labelSentido').innerHTML = this.checked ? "Anti-horÃ¡rio (esquerda)" : "HorÃ¡rio (direita)";
            });
            </script>

  <div class="mb-3">
    <label for="proprietario" class="form-label">Nome do ProprietÃ¡rio:</label>
    <input type="text" class="form-control" name="proprietario" required>
  </div>

  <div class="mb-3">
    <label for="matricula" class="form-label">NÃºmero da MatrÃ­cula:</label>
    <input type="text" class="form-control" name="matricula" required>
  </div>

  <div class="mb-3">
    <label for="descricao" class="form-label">DescriÃ§Ã£o:</label>
    <textarea class="form-control" name="descricao" required></textarea>
  </div>

  <div class="mb-3">
    <label for="excel_file" class="form-label">Arquivo Excel com Confrontantes:</label>
    <input type="file" class="form-control" name="excel_file" accept=".xlsx" required>
  </div>

  <div class="mb-3">
    <label for="dxf_file" class="form-label">Arquivo DXF:</label>
    <input type="file" class="form-control" name="dxf_file" accept=".dxf" required>
  </div>

  <div class="text-center mt-4">
    <button type="submit" class="btn btn-primary">Executar</button>
  </div>
</form>

{% if zip_download %}
    <div class="mt-4 text-center">
        {# ZIP sÃ³ quando houve sucesso #}
        {% if success and zip_url %}
            <a class="btn btn-success btn-lg" href="{{ zip_url }}">ðŸ“¦ Baixar ZIP</a>
        {% elif success and zip_urls %}
            <div class="d-flex flex-wrap gap-2 justify-content-center">
            {% for z in zip_urls %}
                <a class="btn btn-success" href="{{ z }}">ðŸ“¦ {{ z.split('/')[-1] }}</a>
            {% endfor %}
            </div>
        {% endif %}

        {# LOG: sempre que houver URL do log #}
        {% if log_path %}
            <a class="btn btn-outline-secondary ms-2" href="{{ log_path }}">
            ðŸ§¾ Baixar Log da ExecuÃ§Ã£o
            </a>
        {% endif %}

        {# Mensagem de erro quando nÃ£o houve sucesso #}
        {% if not success and erro %}
            <div class="alert alert-warning mt-3">{{ erro }}</div>
        {% endif %}
    </div>
{% endif %}  {# âœ… FECHANDO corretamente o bloco IF #}

{% if resultado %}
  <div class="alert alert-success mt-4">{{ resultado }}</div>
{% endif %}

{% if erro %}
  <div class="alert alert-danger mt-4">{{ erro|safe }}</div>
{% endif %}
{% endblock %}
