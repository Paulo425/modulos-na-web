{% extends 'base.html' %}

{% block head %}
<style>
    body {
            margin: 40px;
            background: #000033; 
            font-family: Arial, sans-serif;
            text-align: center;
            transition: all 0.3s ease;
        }
        h1 {
            margin-bottom: 20px;
            text-align: center;
            color: #ffffff;
        }
        form {
            display: block;
            width: 80%;
            max-width: 640px;
            margin: 0 auto; 
            background: #ffffff; 
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0px 0px 20px rgba(0,0,0,0.3);
            text-align: left;
            color: #000;
        }
        .dark-mode form {
            background: #2f2f2f !important;
            color: #ffffff !important;
        }
        .dark-mode form label {
            color: #ffffff !important;
        }
        .dark-mode .input-change::placeholder {
            color: #000000 !important;
        }
        .toggle-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 14px 24px;
            border-radius: 8px;
            font-weight: bold;
            border: none;
            cursor: pointer;
            color: #ffffff;
            background-color: #1e90ff;
            font-size: 16px;
            box-shadow: 0px 0px 8px rgba(0,0,0,0.3);
        }
        .toggle-btn:hover {
            filter: brightness(1.1);
        }
        label {
            display: block;
            font-weight: bold;
            margin-top: 15px;
            margin-bottom: 5px;
        }
        .input-change {
            width: 100%;
            box-sizing: border-box;
            padding: 10px;
            margin: auto;
            font-size: 14px;
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 3px;
            box-shadow: inset 2px 2px 4px rgba(0,0,0,0.1);
        }
        input[type="file"].file-green {
            width: 100%;
        }
        input[type="file"].file-green::-webkit-file-upload-button {
            background-color: #006400;
            color: #ffffff;
            padding: 10px 20px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
        }
        input[type="file"].file-green::file-selector-button {
            background-color: #006400;
            color: #ffffff;
            padding: 10px 20px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
        }
        .btn {
            margin-top: 20px;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: #fff;
            background-color: #006400; 
        }
        .btn:hover {
            filter: brightness(1.2);
        }
        .center-btn {
            text-align: center;
        }
        .restricoes-container {
            border: 1px solid #ccc;
            padding: 15px;
            margin-top: 15px;
            border-radius: 5px;
            background: #f0f0f0;
            box-shadow: inset 2px 2px 4px rgba(0,0,0,0.1);
        }
        hr {
            margin: 20px 0;
        }
        .subtitle {
            margin-top: 30px;
            font-weight: bold;
            font-size: 1.1em;
        }
        .notice {
            font-size: 0.9em;
            color: #555;
        }
        .small-explanation {
            font-size: 13px;
            line-height: 1.3em;
            text-align: justify;
            text-justify: inter-word;
            margin-bottom: 5px;
            width: 100%;
        }

        /* For√ßar cor verde se autofill em inputs do Chrome */
        input:-webkit-autofill {
            background-color: #ccffcc !important;
            transition: background-color 5000s ease-in-out 0s;
        }
        input:-webkit-autofill:focus {
            background-color: #ccffcc !important;
        }

:root{
            /* paleta base */
            --laranja-claro : #ffeede;
            --laranja-escuro: #ff8c00;
        
            /* azul-escuro para bot√µes ‚Äú+‚Äù e ‚ÄúGerar Laudo‚Äù */
            --azul-top : #004c8c;
            --azul-bot : #002549;
        
            /* relevo */
            --shadow-out :  4px  4px 10px rgba(0,0,0,.18),
                           -4px -4px 10px rgba(255,255,255,.8);
            --shadow-in  : inset 2px  2px  6px rgba(0,0,0,.12),
                           inset -2px -2px 6px rgba(255,255,255,.65);
        
            --radius     : 10px;
            --green-fill : #ccffcc;               /* fundo verde quando houver arquivo */
        }
        
        /* -------- bot√µes gen√©ricos -------- */
        .btn-small{
            padding:8px 18px;
            font-size:14px;
            border:none;
            border-radius:var(--radius);
            background:linear-gradient(180deg,#fafafa 0%,#e7e7e7 100%);
            box-shadow:var(--shadow-out);
            cursor:pointer;
            transition:.15s transform;
        }
        .btn-small:active{ transform:translateY(2px); }
        
        .btn-red{
            background:linear-gradient(180deg,#ca5552 0%,#a94442 100%);
            color:#fff;
        }
        
        /* --------  azul-escuro  -------- */
        .btn-blue{
            background:linear-gradient(180deg,var(--azul-top) 0%,var(--azul-bot) 100%);
            color:#fff;
        }
        
        /* --------  file-picker interno (laranja)  -------- */
        input[type="file"].file-orange::-webkit-file-upload-button,
        input[type="file"].file-orange::file-selector-button{
            background:linear-gradient(180deg,#0d7a43 0%, #064b2e 100%);
            color:#fff;
            border:none;
            padding:10px 24px;
            font-weight:bold;
            border-radius:var(--radius);
            box-shadow:var(--shadow-out);
            cursor:pointer;
        }
        
        /* --------  cart√£o 3-D -------- */
        .wrapper-3d{
            display:flex;
            flex-wrap:wrap;
            gap:12px;
            align-items:center;
        
            background:var(--laranja-claro);
            border:2px solid var(--laranja-escuro);
            border-radius:var(--radius);
            padding:18px;
            margin-bottom:26px;
            box-shadow:var(--shadow-out);
        }
        .wrapper-3d:has(input[type=file]:focus-within){
            box-shadow:var(--shadow-in),var(--shadow-out);
        }
        .wrapper-3d input[type=file]{
            flex:1;
            min-width:260px;
            padding:10px;
            border-radius:var(--radius);
            transition:background-color .25s ease;
            color:#000;                /* ‚Üê texto preto SEMPRE */
        }
        .wrapper-3d input[type=file].filled{ background-color:var(--green-fill); }
        .wrapper-3d input[type=file].filled { 
        background-color: var(--green-fill) !important; 
        }
        .input-change.filled {
        background-color: #ccffcc !important;
        }
        input[type="file"].file-green::-webkit-file-upload-button,
        input[type="file"].file-green::file-selector-button {
            background-color: #006400 !important;
            color: #ffffff !important;
            padding: 10px 20px !important;
            border: none !important;
            font-weight: bold !important;
            cursor: pointer !important;
            border-radius: 5px !important;
        }


</style>   
{% endblock %}

{% block conteudo %}
<div class="container mt-5">
    {% if resultado %}
    <div class="alert alert-success text-center mt-3">
        {{ resultado|safe }}
        {% if zip_download %}
            <br>
            <a href="{{ url_for('static', filename='arquivos/' + zip_download) }}" 
              class="btn btn-success mt-2"
              id="botaoZip"
              download>
                üì• Baixar Arquivo ZIP
            </a>
        {% endif %}
    </div>
    {% endif %}

    {% if erro %}
    <div class="alert alert-danger text-center mt-3">
        {{ erro|safe }}
    </div>
    {% endif %}


    {% if log_path %}
        <a href="{{ url_for('static', filename=log_path) }}" class="btn btn-info mt-2" download>
            üìã Baixar Log da Execu√ß√£o
        </a>
    {% endif %}

    <button class="toggle-btn" onclick="toggleDarkMode()">Alternar Modo</button>

    <h1>FORMUL√ÅRIO DE AVALIA√á√ÉO PHOENIX APPRAISAL</h1>

    <form method="post" enctype="multipart/form-data">
      

        <label>INSIRA AQUI SUA PLANILHA DE AMOSTRAS (Excel):</label>
        <input type="file" name="planilha_excel" class="input-change file-green" required>

        <label>Informe o nome completo do propriet√°rio do im√≥vel:</label>
        <input type="text" name="nome_proprietario" class="input-change" placeholder="Ex: Jos√© da Silva" required>

        <label>Existem outros propriet√°rios? (Sim ou N√£o):</label>
        <select name="outros_proprietarios" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>

        <label>Deseja incluir telefone do propriet√°rio? (Sim ou N√£o):</label>
        <select name="incluir_tel" id="incluirTelSelect" class="input-change" onchange="toggleTelefoneCampo()">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
        <div id="telefoneCampo" style="display:none;">
          <label>Digite o telefone do propriet√°rio:</label>
          <input type="text" name="telefone_proprietario" class="input-change" placeholder="Ex: (47) 99999-8888">
        </div>

        <label>Deseja incluir email do propriet√°rio? (Sim ou N√£o):</label>
        <select name="incluir_mail" id="incluirMailSelect" class="input-change" onchange="toggleEmailCampo()">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
        <div id="emailCampo" style="display:none;">
          <label>Digite o email do propriet√°rio:</label>
          <input type="text" name="email_proprietario" class="input-change" placeholder="Ex: exemplo@dominio.com">
        </div>

        <label>Informe o nome do solicitante do laudo:</label>
        <input type="text" name="nome_solicitante" class="input-change" placeholder="Ex: Prefeitura Municipal de Joinville-SC">

        <label>Informe o nome do avaliador respons√°vel:</label>
        <input type="text" name="nome_avaliador" class="input-change" placeholder="Ex: Eng. Civil Paulo Roberto">

        <label>Informe o registro profissional do avaliador:</label>
        <input type="text" name="registro_avaliador" class="input-change" placeholder="Ex: CREA SP 45.678/D">

        <label>Qual tipo de im√≥vel est√° sendo avaliado?</label>
        <select name="tipo_imovel_escolhido" class="input-change">
            <option value="" disabled selected>Selecione</option>
            <option value="Apartamento residencial">Apartamento residencial</option>
            <option value="Casa residencial">Casa residencial</option>
            <option value="Terreno urbano">Terreno urbano</option>
            <option value="Gleba urbana">Gleba urbana</option>
            <option value="Terreno rural">Terreno rural</option>
            <option value="Gleba rural">Gleba rural</option>
        </select>

        <label>Qual a finalidade do laudo?</label>
        <select name="finalidade_lido" id="finalidadeSelect" class="input-change" onchange="atualizarAreaLabel(); exibirRestricoesSeNecessario();">
            <option value="" disabled selected>Selecione</option>
            <option value="Desapropria√ß√£o do Im√≥vel">Desapropria√ß√£o do Im√≥vel</option>
            <option value="Avalia√ß√£o para Garantia Banc√°ria">Avalia√ß√£o para Garantia Banc√°ria</option>
            <option value="Avalia√ß√£o para processos de Invent√°rio e Partilha">Avalia√ß√£o para processos de Invent√°rio e Partilha</option>
            <option value="Avalia√ß√£o de mercado para Compra e venda do Im√≥vel">Avalia√ß√£o de mercado para Compra e venda do Im√≥vel</option>
            <option value="Avalia√ß√£o para obten√ß√£o do valor de Loca√ß√£o do Im√≥vel">Avalia√ß√£o para obten√ß√£o do valor de Loca√ß√£o do Im√≥vel</option>
            <option value="Avalia√ß√£o para Regulariza√ß√£o Fiscal do Im√≥vel">Avalia√ß√£o para Regulariza√ß√£o Fiscal do Im√≥vel</option>
            <option value="Avalia√ß√£o para a obten√ß√£o de Seguro patrimonial do Im√≥vel">Avalia√ß√£o para a obten√ß√£o de Seguro patrimonial do Im√≥vel</option>
            <option value="Avalia√ß√£o para Implanta√ß√£o de Servid√£o Administrativa">Avalia√ß√£o para Implanta√ß√£o de Servid√£o Administrativa</option>
            <option value="Avalia√ß√£o para Regulariza√ß√£o do Im√≥vel">Avalia√ß√£o para Regulariza√ß√£o do Im√≥vel</option>
        </select>
        
      
        <label id="areaLabel" for="areaInput">
            Insira a √°rea total do im√≥vel a ser avaliado (m¬≤)
        </label>
        <input type="text"
               id="areaInput"
               name="area_parcial"
               class="input-change"
               placeholder="Ex: 29.567,89">
        <div id="areaInfoBox" style="display:none;"></div>


        <!-- RESTRI√á√ïES -->
        <div id="restricoesSectionContainer" style="display:none;">
          <hr>
          <div class="subtitle">M√∫ltiplas Restri√ß√µes</div>
          <p class="notice">Insira todas as restri√ß√µes desejadas. Ao clicar em "Adicionar Restri√ß√£o", outra aparecer√°.</p>
          <div id="restricoesSection"></div>
          <button type="button" class="btn" onclick="addRestricao()">Adicionar Restri√ß√£o</button>
          <hr>
        </div>

        <div class="subtitle">FATORES DE HOMOGENEIZA√á√ÉO DAS AMOSTRAS</div>

        <label>Fator √Årea</label>
        <p class="small-explanation">
          Tem como objetivo adequar o valor da amostra √† √°rea do avaliando, aplicando ((√Årea da amostra /
          √Årea do avaliando)^(0,25)), atenuando grandes distor√ß√µes (Abunahman, Ed. Pini).
        </p>
        <label>Usar fator √Årea? (Sim ou N√£o)</label>
        <select name="usar_fator_area" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
        <hr>

        <label>Fator Oferta</label>
        <p class="small-explanation">
          Ajusta os valores para 0,90 se h√° indica√ß√£o clara de oferta abundante. Caso contr√°rio, 1,00. Este
          fator previne distor√ß√µes em cen√°rios com alto estoque de im√≥veis.
        </p>
        <label>Usar fator Oferta? (Sim ou N√£o)</label>
        <select name="usar_fator_oferta" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
        <hr>

        <label>Fator Aproveitamento</label>
        <p class="small-explanation">
          Se urbano, adota-se 1,00; se rural, 0,80. Metodologia adaptada de Jo√£o Ruy Canteiro (Ed. Pini),
          considerando o potencial construtivo do im√≥vel.
        </p>
        <label>Usar fator Aproveitamento? (Sim ou N√£o)</label>
        <select name="usar_fator_aproveitamento" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
        <hr>

        <label>Fator Localiza√ß√£o</label>
        <p class="small-explanation">
          Se amostras e avaliando est√£o na mesma regi√£o (~1 km), fator=1,00; caso contr√°rio, utiliza-se
          f√≥rmula adaptada de Martins & Martins (2014, p.341) baseada na dist√¢ncia.
        </p>
        <label>O im√≥vel avaliando est√° na mesma regi√£o (~1km) das amostras? (Sim ou N√£o)</label>
        <select name="localizacao_mesma_regiao" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
        <hr>

        <label>Fator Topografia</label>
        <p class="small-explanation">
          Se a topografia for boa, emprega-se 1,10; caso contr√°rio, 1,00. Adapta√ß√£o de Jo√£o R. Canteiro
          (Ed. Pini), refletindo o relevo do terreno.
        </p>
        <label>Usar fator Topografia? (Sim ou N√£o)</label>
        <select name="usar_fator_topografia" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
        <hr>

        <label>Fator Pedologia</label>
        <p class="small-explanation">
          Caso o solo seja alag√°vel, aplica-se 0,70 (deprecia√ß√£o de 30%). Se normal, 1,00. Crit√©rio baseado
          em Jo√£o R. Canteiro (Ed. Pini).
        </p>
        <label>Usar fator Pedologia? (Sim ou N√£o)</label>
        <select name="usar_fator_pedologia" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
        <hr>

        <label>Fator Pavimenta√ß√£o</label>
        <p class="small-explanation">
          Presen√ßa de pavimenta√ß√£o mant√©m fator 1,00; aus√™ncia reduz para 0,90. Segue o crit√©rio de
          Mendes Sobrinho, indicando 10% de desvaloriza√ß√£o.
        </p>
        <label>Usar fator Pavimenta√ß√£o? (Sim ou N√£o)</label>
        <select name="usar_fator_pavimentacao" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
        <hr>

        <label>Fator Esquina</label>
        <p class="small-explanation">
          Terrenos em esquina recebem fator 1,10; os demais, 1,00. Conforme Thofehrn (2008), h√° um
          acr√©scimo limitado a 10% para compensar recuos.
        </p>
        <label>Usar fator Esquina? (Sim ou N√£o)</label>
        <select name="usar_fator_esquina" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
        <hr>

        <label>Fator Acessibilidade</label>
        <p class="small-explanation">
          Boa acessibilidade, fator 1,00; em caso de acesso dif√≠cil, 0,90. Adaptado do crit√©rio de Mendes
          Sobrinho, demonstrando 10% de deprecia√ß√£o.
        </p>
        <label>Usar fator Acessibilidade? (Sim ou N√£o)</label>
        <select name="usar_fator_acessibilidade" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
        </select>
        <hr>

        <label>N√∫mero da matr√≠cula (documenta√ß√£o do im√≥vel):</label>
        <input type="text" name="num_doc" class="input-change" placeholder="Ex: 12.345">

        <label>Nome do cart√≥rio:</label>
        <input type="text" name="nome_cartorio" class="input-change" placeholder="Ex: Of√≠cio de Registros P√∫blicos">

        <label>Nome da comarca:</label>
        <input type="text" name="nome_comarca" class="input-change" placeholder="Ex: Joinville-SC">

        <label>Endere√ßo completo do im√≥vel:</label>
        <input type="text" name="endereco_imovel" class="input-change"
               placeholder="Ex: Rua Dr. Pl√°cido Olimpio de Oliveira, 1277 - Anita Garibaldi - Joinville-SC">

        <hr>
        <div class="subtitle">Diagn√≥stico de Mercado</div>

        <label>Estrutura</label>
        <p class="small-explanation">
          Pode ser BOA (facilidade de encontrar im√≥veis similares na regi√£o) ou LIMITADA (dificuldade).
        </p>
        <select name="estrutura_escolha" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="BOA">BOA</option>
          <option value="LIMITADA">LIMITADA</option>
        </select>
        <hr>

        <label>Conduta</label>
        <p class="small-explanation">
          DESESTAGNADO (boa movimenta√ß√£o do mercado) ou ESTAGNADA (pouca movimenta√ß√£o).
        </p>
        <select name="conduta_escolha" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="DESESTAGNADO">DESESTAGNADO</option>
          <option value="ESTAGNADA">ESTAGNADA</option>
        </select>
        <hr>

        <label>Desempenho</label>
        <p class="small-explanation">
          ALTO (grande atratividade comercial), M√âDIO (atratividade moderada) ou BAIXO (baixa atratividade).
        </p>
        <select name="desempenho_escolha" class="input-change">
          <option value="" disabled selected>Selecione</option>
          <option value="ALTO">ALTO</option>
          <option value="M√âDIO">M√âDIO</option>
          <option value="BAIXO">BAIXO</option>
        </select>


          
        
        <!-- ===========================================================
         üÖë  FOTOS DO IM√ìVEL  (multiple ‚áí sem ‚Äú+‚Äù)
        =========================================================== -->
        <hr>
        <div class="subtitle">Acrescente as Fotos do im√≥vel avaliando:</div>
        
        <div id="fotoWrapper" class="wrapper-3d">
            <input type="file"
                   name="fotos_imovel"
                   class="input-change file-orange"
                   multiple>
            <button type="button"
                    id="clearFotoBtn"
                    class="btn-small btn-red"
                    onclick="clearFotos()">Limpar</button>
        </div>
        
        <!-- ===========================================================
         üÖí  DOCUMENTA√á√ÉO DO IM√ìVEL
        =========================================================== -->
        <div class="subtitle">Acrescente a Documenta√ß√£o do im√≥vel avaliando:</div>
        
        <div id="imovWrapper" class="wrapper-3d">
            <input type="file"
                   name="fotos_imovel_adicionais"
                   class="input-change file-orange">
            <button type="button"
                    id="addImovBtn"
                    class="btn-small btn-blue"
                    onclick="addImovInput()">+</button>
            <button type="button"
                    id="clearImovBtn"
                    class="btn-small btn-red"
                    onclick="clearImovs()">Limpar</button>
        </div>
        
        <!-- ===========================================================
         üÖì  DOCUMENTA√á√ÉO DO(S) PROPRIET√ÅRIO(S)
        =========================================================== -->
        <div class="subtitle">Acrescente a Documenta√ß√£o do(s) propriet√°rio(s):</div>
        
        <div id="propWrapper" class="wrapper-3d">
            <input type="file"
                   name="doc_proprietario"
                   class="input-change file-orange">
            <button type="button"
                    id="addPropBtn"
                    class="btn-small btn-blue"
                    onclick="addPropInput()">+</button>
            <button type="button"
                    id="clearPropBtn"
                    class="btn-small btn-red"
                    onclick="clearProps()">Limpar</button>
        </div>
        
        <!-- ===========================================================
         üÖî  PLANTAS / MEMORIAIS
        =========================================================== -->
        <div class="subtitle">Adicione Plantas e Memoriais Descritivos do Avaliando:</div>
        
        <div id="plantaWrapper" class="wrapper-3d">
            <input type="file"
                   name="doc_planta"
                   class="input-change file-orange">
            <button type="button"
                    id="addPlantaBtn"
                    class="btn-small btn-blue"
                    onclick="addPlantaInput()">+</button>
            <button type="button"
                    id="clearPlantaBtn"
                    class="btn-small btn-red"
                    onclick="clearPlantas()">Limpar</button>
        </div>
        
        <!-- ===========================================================
         üÖï  LOGOTIPO
        =========================================================== -->
        <label>Selecione arquivo de imagem do logo (se desejar):</label>
        
        <div id="logoWrapper" class="wrapper-3d">
            <input type="file"
                   name="arquivo_logo"
                   class="input-change file-orange">
            <button type="button"
                    id="clearLogoBtn"
                    class="btn-small btn-red"
                    onclick="clearLogo()">Limpar</button>
        </div>
        
        <br><br>
        <div class="center-btn">
          <button type="submit"
                  class="btn-small btn-blue"
                  style="font-size:16px;padding:14px 36px;">Gerar Laudo</button>
        </div>
        
        
    </form>

</div>
{% endblock %}

{% block scripts %}
<script>
function toggleTelefoneCampo() {
    const incluirTelSelect = document.getElementById("incluirTelSelect");
    const telefoneCampo = document.getElementById("telefoneCampo");
    telefoneCampo.style.display = incluirTelSelect.value === "sim" ? "block" : "none";
}

function toggleEmailCampo() {
    const incluirMailSelect = document.getElementById("incluirMailSelect");
    const emailCampo = document.getElementById("emailCampo");
    emailCampo.style.display = incluirMailSelect.value === "sim" ? "block" : "none";
}

function exibirRestricoesSeNecessario() {
    const finalidadeSelect = document.getElementById("finalidadeSelect");
    const restricoesContainer = document.getElementById("restricoesSectionContainer");
    restricoesContainer.style.display = finalidadeSelect.value.includes("Desapropria√ß√£o") ? "block" : "none";
}

function addRestricao() {
    const restricoesSection = document.getElementById("restricoesSection");
    const div = document.createElement("div");
    div.className = "restricoes-container";
    div.innerHTML = `
        <label>Descri√ß√£o da restri√ß√£o:</label>
        <input type="text" name="restricoes[]" class="input-change">
        <label>Arquivo relacionado:</label>
        <input type="file" name="arquivos_restricoes[]" class="input-change file-green">
    `;
    restricoesSection.appendChild(div);
}

function atualizarAreaLabel() {
    const finalidadeSelect = document.getElementById("finalidadeSelect");
    const valor = (finalidadeSelect.value || "").trim().toLowerCase();
    const areaLabel = document.getElementById("areaLabel");
    const areaInput = document.getElementById('areaInput');
    const infoBox = document.getElementById("areaInfoBox");

    if (valor.includes("desapropria")) {
        areaLabel.innerHTML = "<strong>√ÅREA A SER DESAPROPRIADA (m¬≤)</strong>";
        areaLabel.style.color = "#b20000";
        areaInput.style.borderColor = "#b20000";
        areaInput.style.borderWidth = "2px";
        areaInput.style.fontWeight = "bold";
        areaInput.placeholder = "Ex: 1.250,00";
        infoBox.style.display = "block";
        infoBox.innerHTML = "<strong>IMPORTANTE:</strong> A √°rea digitada substituir√° a planilha.";
    } else if (valor.includes("servid")) {
        areaLabel.innerHTML = "<strong>√ÅREA DE INTERESSE PARA SERVID√ÉO (m¬≤)</strong>";
        areaLabel.style.color = "#b20000";
        areaInput.style.borderColor = "#b20000";
        areaInput.style.borderWidth = "2px";
        areaInput.style.fontWeight = "bold";
        areaInput.placeholder = "Ex: 3.500,00";
        infoBox.style.display = "block";
        infoBox.innerHTML = "<strong>IMPORTANTE:</strong> A √°rea digitada substituir√° a planilha.";
    } else {
        areaLabel.innerHTML = "√Årea total do im√≥vel a ser avaliado (m¬≤)";
        areaLabel.style.color = "";
        areaInput.style.borderColor = "";
        infoBox.style.display = "none";
    }
}

const addHighlightListener = inp => {
    const handler = () => inp.classList.toggle('filled', inp.files.length > 0);
    handler(); 
    inp.addEventListener('change', handler);
};

document.addEventListener('DOMContentLoaded', () => {
    toggleTelefoneCampo();
    toggleEmailCampo();
    exibirRestricoesSeNecessario();
    atualizarAreaLabel();

    document.querySelectorAll('.wrapper-3d input[type="file"]').forEach(addHighlightListener);
    document.querySelectorAll('.input-change').forEach(field => {
        const checkFill = () => field.classList.toggle('filled', field.value.trim() !== '');
        checkFill();
        field.addEventListener('input', checkFill);
        field.addEventListener('change', checkFill);
    });

    document.getElementById("incluirTelSelect").addEventListener("change", toggleTelefoneCampo);
    document.getElementById("incluirMailSelect").addEventListener("change", toggleEmailCampo);
    document.getElementById("finalidadeSelect").addEventListener("change", () => {
        atualizarAreaLabel();
        exibirRestricoesSeNecessario();
    });
});
</script>
{% endblock %}

